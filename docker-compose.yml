services:
  express-app:
    build: .
    container_name: modulo-anagrafica-container
    restart: always  # <--- QUESTA Ã¨ la riga magica per la VPS
    ports:
      - "127.0.0.1:3000:3000"
    environment:
      - PORT=${PORT}
      - GEMINI_API_KEY=${GEMINI_API_KEY}
      - POCKET_BASE_URI=${POCKET_BASE_URI}
      - POCKET_BASE_USER=${POCKET_BASE_USER}
      - POCKET_BASE_PASSWORD=${POCKET_BASE_PASSWORD}
    volumes:
      - .:/app
      - /app/.env         # "Nasconde" il .env interno (lo rende vuoto/inaccessibile)
      - /app/node_modules # Protegge i moduli installati nel container
  pocketbase:
    image: ghcr.io/muchobien/pocketbase:latest # Immagine aggiornata e affidabile
    container_name: pocketbase-authenticator-container
    ports:
      - "127.0.0.1:8090:8090" # Accessibile dal bridge Docker
    volumes:
      - ./pb_data:/pb_data
    command:
      - serve
      - --http=0.0.0.0:8090
    restart: always
